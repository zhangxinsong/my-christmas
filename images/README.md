# Images 文件夹使用说明

本文件夹用于存储圣诞树粒子系统的照片文件，示例照片均为AI生成。

---

## 📸 文件命名规则

照片必须按以下格式命名才能被自动加载：

```
(1).jpg
(2).png
(3).webp
(4).jpg
...
(168).png
```

**重要规则**：
- ✅ 序号必须从 **1** 开始（不是 0）
- ✅ 使用**英文半角括号** `( )`
- ✅ 序号连续或有少量缺口（默认容忍 10 个连续失败）
- ✅ 支持混合格式（同一文件夹可以有多种格式）

---

## 🖼️ 支持的图片格式

系统会按以下优先级自动尝试：

1. `.jpg` - JPEG 格式（推荐，兼容性最好）
2. `.jpeg` - JPEG 格式（另一种扩展名）
3. `.png` - PNG 格式（支持透明背景）
4. `.webp` - WebP 格式（更小的文件）
5. `.gif` - GIF 格式（支持动图）
6. `.bmp` - BMP 格式（不推荐，文件过大）

**示例**：
```
images/
  (1).jpg   ✓ 自动找到并加载
  (2).png   ✓ 尝试 .jpg 失败后找到 .png
  (3).webp  ✓ 尝试 .jpg、.jpeg、.png 失败后找到 .webp
  ...
```

---

## 📏 图片尺寸建议

### 推荐尺寸
- **最佳尺寸**：2048×2048 或以下
- **最小尺寸**：512×512（太小会影响显示效果）
- **最大尺寸**：4096×4096（超过 2048 会自动压缩）

### 为什么是 2048px？
- 大多数设备 GPU 纹理上限
- 平衡显示质量和性能
- 自动压缩目标尺寸

### 文件大小建议
- **推荐大小**：< 1MB/张
- **最大限制**：50MB/张（单个文件上传限制）
- **总大小建议**：整个文件夹 < 100MB（最佳加载速度）

---

## 🛠️ 使用 Python 工具预处理

### 1. 批量重命名

将任意命名的照片重命名为规范格式：

```bash
# 交互模式
python rename_images.py

# 自动确认模式
python rename_images.py -y
```

**效果**：
```
IMG_1234.jpg  →  (1).jpg
DSC_5678.png  →  (2).jpg
照片123.jpg   →  (3).jpg
```

### 2. 批量压缩

提前压缩照片，加快网页加载速度：

```bash
# 压缩并备份原图（推荐）
python compress_images.py

# 压缩不备份（慎用）
python compress_images.py --no-backup

# 输出到指定文件夹
python compress_images.py --output ./compressed
```

**效果**：
- 4096×3072 → 2048×1536（压缩 90%）
- 5.71 MB → 530 KB
- JPEG 质量 90%（高质量）

**依赖安装**：
```bash
pip install Pillow
```

---

## 🚀 推荐工作流程

### 方式 A：完整工作流（推荐）

```bash
# 1. 复制照片到 images 文件夹
cp ~/Photos/*.jpg images/

# 2. 批量重命名
cd ..
python rename_images.py -y

# 3. 批量压缩（大幅提升加载速度）
python compress_images.py

# 4. 检查结果
ls -lh images/

# 5. 删除备份（确认无误后）
rm images/*_original.jpg

# 6. 启动服务器并访问
python -m http.server 8000
```

### 方式 B：快速测试

如果只是测试或照片数量少（< 30 张）：

```bash
# 1. 手动重命名照片为 (1).jpg, (2).jpg...
# 2. 直接放入 images 文件夹
# 3. 刷新网页
```

### 方式 C：手动上传

不想预处理？使用网页上传：

1. 启动网页
2. 点击右上角 "Select Folder" 或 "Select Files"
3. 选择照片
4. 自动压缩并加载（实时压缩）

---

## ⚙️ 配置调整

### 容忍序号缺口

如果照片序号不连续，可调整容忍度：

编辑 `../config.json`：
```json
{
  "loader": {
    "maxConsecutiveFails": 20  // 默认 10，改为 20
  }
}
```

**示例**：
```
(1).jpg  ✓
(2).jpg  ✓
(3).jpg  ✗ 缺失
(4).jpg  ✗ 缺失
...
(15).jpg ✗ 缺失（第 13 个失败）
(16).jpg ✗ 缺失（第 14 个失败）
...
(21).jpg ✓ 找到！（因为设置了容忍 20 次）
```

### 增加最大扫描数量

默认扫描 500 张，如果照片更多：

```json
{
  "loader": {
    "maxImages": 1000  // 默认 500，改为 1000
  }
}
```

### 调整格式优先级

如果主要使用 PNG 格式：

```json
{
  "loader": {
    "supportedExtensions": [
      ".png",    // PNG 优先
      ".jpg",
      ".jpeg",
      ".webp",
      ".gif",
      ".bmp"
    ]
  }
}
```

---

## 📊 性能优化建议

### 低端设备（内存 < 4GB）
- **照片数量**：< 30 张
- **单张大小**：< 500KB
- **总大小**：< 15MB
- **必须预压缩**：是

### 中端设备（内存 4-8GB）
- **照片数量**：30-100 张
- **单张大小**：< 1MB
- **总大小**：< 50MB
- **建议预压缩**：是

### 高端设备（内存 > 8GB）
- **照片数量**：100-200 张
- **单张大小**：< 2MB
- **总大小**：< 100MB
- **建议预压缩**：是（加载更快）

---

## ⚠️ 注意事项

### 隐私保护

如果部署到公共服务器（如 GitHub Pages）：

- ⚠️ **所有照片将公开可访问**
- ⚠️ **任何人都可以通过 URL 查看**
- ⚠️ **搜索引擎可能会索引**

**建议**：
- 仅部署不包含私人信息的照片
- 使用私有服务器 + 密码保护
- 或仅在本地运行

### 文件安全

**不要包含**：
- 含有个人敏感信息的照片
- 身份证、护照等证件照片
- 位置信息敏感的照片
- 他人不愿公开的照片

**最佳实践**：
1. 使用前检查照片 EXIF 信息
2. 删除地理位置标签
3. 考虑添加水印

### 版权声明

- 确保你拥有照片的使用权
- 不要使用有版权保护的图片
- 注意他人肖像权

---

## 🐛 常见问题

### Q1: 照片没有加载？

检查：
1. 文件命名是否正确（从 1 开始，使用英文括号）
2. 是否启动了本地服务器（不能直接打开 HTML）
3. 查看浏览器控制台错误信息
4. 检查文件格式是否支持

### Q2: 只加载了部分照片？

可能原因：
- 序号不连续，超过默认容忍次数（10 次）
- 达到最大扫描数量（默认 500）
- 达到最大加载数量（默认 50，在 config.json 中）

解决方法：
- 调整 `maxConsecutiveFails` 参数
- 调整 `maxImages` 参数
- 调整 `performance.maxPhotos` 参数

### Q3: 照片显示模糊？

可能原因：
- 原图太小（< 512px）
- 压缩质量过低
- 浏览器缩放设置

解决方法：
- 使用更高分辨率的原图
- 提高压缩质量（compress_images.py 中改为 95）
- 检查浏览器缩放设置（Ctrl+0 重置）

### Q4: 加载速度很慢？

优化方法：
1. **使用 Python 预压缩**（最有效）
   ```bash
   python compress_images.py
   ```

2. **减少照片数量**
   ```json
   {
     "performance": {
       "maxPhotos": 30  // 限制加载数量
     }
   }
   ```

3. **降低照片质量**
   - 调整压缩质量为 80-85

4. **使用 WebP 格式**
   - 比 JPEG 小 30-40%
   - 需要转换工具

### Q5: 内存占用过高？

解决方法：
- 减少照片数量
- 预压缩照片到 1024×1024
- 限制 `performance.maxPhotos` 为 20-30
- 禁用部分粒子效果

---

## 📁 文件夹示例

### 良好的文件结构

```
images/
├── (1).jpg       # 90KB
├── (2).jpg       # 85KB
├── (3).png       # 120KB
├── (4).jpg       # 95KB
├── ...
├── (50).jpg      # 88KB
└── README.md     # 本文件
```

**特点**：
- ✅ 序号连续
- ✅ 文件大小合理（< 1MB）
- ✅ 格式统一或混合
- ✅ 总大小适中（< 50MB）

### 不推荐的结构

```
images/
├── IMG_1234.jpg      # ❌ 文件名不规范
├── (0).jpg           # ❌ 序号应从 1 开始
├── (1).jpg           # ✅
├── 照片2.jpg         # ❌ 中文命名
├── (10).jpg          # ⚠️ 序号跳跃过大
├── photo_100.jpg     # ❌ 命名格式错误
└── image.png         # ❌ 没有序号
```

---

## 🔗 相关文档

- [主文档](../README.md) - 项目完整说明
- [配置文档](../README.md#%EF%B8%8F-配置说明) - config.json 配置详解
- [Python 工具](../README.md#-python-工具) - 批量处理工具说明
- [常见问题](../README.md#-常见问题) - 更多问题解答

---

## 📊 性能基准

基于 168 张照片的测试数据：

| 场景 | 文件大小 | 加载时间 | 内存占用 |
|-----|---------|---------|---------|
| **未压缩** | 542MB | 60 秒 | 250MB |
| **预压缩** | 85MB | 6 秒 | 150MB |
| **实时压缩** | 542MB | 45 秒 | 200MB |

**结论**：预压缩可提升 10 倍加载速度！

---

**最后更新**：2025-12-09
**适用版本**：v3.0
